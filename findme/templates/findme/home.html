{% extends "base.html" %}
{% load highlight %}

{% block title %}Lost Items{% endblock %}

{% block content %}

<!-- HEADER + LOCATION BUTTON -->
<div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center mb-4">
    <h4 class="fw-bold mb-3 mb-md-0">Lost Items</h4>

    <button class="btn btn-primary" onclick="getLocation()">
        ğŸ“ Find Items Near Me
    </button>
</div>
{% if query or status %}
<div class="mb-3">
    <span class="text-muted small">
        Showing results
        {% if query %}for "<strong>{{ query }}</strong>"{% endif %}
        {% if status %} ({{ status|title }}){% endif %}
    </span>
    <a href="/" class="ms-2 small text-decoration-none">Clear</a>
</div>
{% endif %}

<!-- LOST ITEMS GRID -->
<div class="row g-3">
    {% for item in lost_items %}
        <div class="col-6 col-md-4 col-lg-3">
            <div class="card h-100 shadow-sm border-0">


                <!-- Image -->
                {% if item.image %}
                    <img src="{{ item.image.url }}"
                         class="card-img-top"
                         style="height:180px; object-fit:cover;">
                {% else %}
                    <div class="d-flex align-items-center justify-content-center bg-secondary text-white"
                         style="height:180px;">
                        No Image
                    </div>
                {% endif %}

                <!-- Body -->
                <div class="card-body d-flex flex-column">
    <h6 class="card-title mb-1">
        {{ item.title|highlight:query|safe }}
    </h6>

    <p class="text-muted small mb-2">
        ğŸ“ {{ item.location }}
    </p>

    {% if item.found %}
        <span class="badge bg-success align-self-start mb-2">Found</span>
    {% else %}
        <span class="badge bg-danger align-self-start mb-2">Lost</span>
    {% endif %}

    {% if user.is_authenticated and item.owner != user %}
        <a href="{% url 'start_chat' item.id %}"
           class="btn btn-sm btn-outline-primary mt-auto w-100">
           ğŸ’¬ Chat with Owner
        </a>
    {% endif %}
</div>

                <!-- Footer -->
                <div class="card-footer bg-white border-0 pt-0">
                    <small class="text-muted">
                        ğŸ•’ {{ item.lost_date|date:"M d, Y" }}
                    </small>
                </div>

            </div>
        </div>
    {% empty %}
        <div class="text-center text-muted mt-5">
            <p>No lost items found.</p>
        </div>
    {% endfor %}
</div>

{% endblock %}
